
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Run Data Assimilation (Individual Seasonality) &#8212; Updating LMRv2.1 with PReSto2k data and LinkedEarth Tools</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/data_assimilation/C02_b_DA_with_individual_seasonality';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Validating PReSto2k" href="../validation/C03_a_validating_PReSto2k.html" />
    <link rel="prev" title="Assembling the proxy database from the LiPDGraph" href="../data_assembly/C01_d_db_assembly_LiPDGraph.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
  
  
    <p class="title logo__title">Updating LMRv2.1 with PReSto2k data and LinkedEarth Tools</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    PReSto2k: updating LMRv2.1 with LinkedEarth Tools
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Assembly</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data_assembly/C01_c_db_assembly_LiPDverse.html">Assembling the proxy database from the LiPDVerse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_assembly/C01_d_db_assembly_LiPDGraph.html">Assembling the proxy database from the LiPDGraph</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Assimilation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Run Data Assimilation (Individual Seasonality)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Validation and Comparison</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../validation/C03_a_validating_PReSto2k.html">Validating PReSto2k</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation/C03_b_proxydb_compare.html">Proxy Database Comparisons</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LinkedEarth/presto2k_cfr_pb" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LinkedEarth/presto2k_cfr_pb/issues/new?title=Issue%20on%20page%20%2Fnotebooks/data_assimilation/C02_b_DA_with_individual_seasonality.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/data_assimilation/C02_b_DA_with_individual_seasonality.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Run Data Assimilation (Individual Seasonality)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#author">Author</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shell-file-for-carc">shell file for CARC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-proxies">Load proxies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-model-prior">Load model prior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-calibration-data">Load calibration data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calibrate-psms">Calibrate PSMs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-psms">Run PSMs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annualize-and-regrid-model-prior-fields">Annualize and Regrid model prior fields</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-save-the-job-object-for-later-reload">(Optional) Save the job object for later reload</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-da-solver">Run DA solver</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#figure-checks">Figure checks</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="run-data-assimilation-individual-seasonality">
<h1>Run Data Assimilation (Individual Seasonality)<a class="headerlink" href="#run-data-assimilation-individual-seasonality" title="Link to this heading">#</a></h1>
<p>In this notebook, we will run the data assimilation (DA) that will get us from data to reconstruction. The goal is to use <em>cfr</em>’s codebase with no edits to make updates on LMRv2.1 <a class="reference external" href="https://cp.copernicus.org/articles/15/1251/2019/">Tardif et al. 2019</a> using the <a class="reference external" href="https://paleopresto.github.io/">PReSto2k</a> Proxy Database.</p>
<section id="author">
<h2>Author<a class="headerlink" href="#author" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://orcid.org/0009-0004-2440-3266">Tanaya Gondhalekar</a></p>
<p>⚠️ <strong>Warning</strong></p>
<p>This notebook cannot be run locally! The process is run on USC’s Center for Advanced Research Computing (<a class="reference external" href="https://www.carc.usc.edu">CARC</a>) HPC Servers. The specifications used will be provided in the shell file below.</p>
<section id="shell-file-for-carc">
<h3>shell file for CARC<a class="headerlink" href="#shell-file-for-carc" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --partition=main</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --mem=32G</span>
<span class="c1">#SBATCH --time=40:00:00</span>

module<span class="w"> </span>purge
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>conda<span class="w"> </span>shell.bash<span class="w"> </span>hook<span class="k">)</span><span class="s2">&quot;</span>

conda<span class="w"> </span>activate<span class="w"> </span>cfr-env

python<span class="w"> </span>lmr_reproduce.py
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span><span class="w"> </span><span class="nn">cfr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cfr</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025.7.28
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="load-data">
<h2>Load Data<a class="headerlink" href="#load-data" title="Link to this heading">#</a></h2>
<p>The data needed to run this reconstruction comes in three parts:</p>
<ul class="simple">
<li><p>Prior: Model output climate data (CMIP5 CCSM4)</p></li>
<li><p>Calibration: Instrumental climate data (temperature: GISTEMPv4, precipitation: GPCCv6)</p></li>
<li><p>Proxy: Proxy data (from PAGES2k consortium)</p></li>
</ul>
<ol class="arabic simple">
<li><p>Download from <a class="reference external" href="http://www.atmos.uw.edu/~wperkins/nobackup/lmr_data/LMR_data.tar.gz">here</a></p></li>
<li><p>Extract all relevant contents into ./prev_data/</p></li>
<li><p><strong>Prior</strong> data can be found under LMR_data &gt; data &gt; model &gt; ccsm4_last_millenium<br />
a. Put in directory ./prev_data/ccsm4_last_millenium/ <br />
b. Required:</p>
<ul class="simple">
<li><p>pr_sfc_Amon_CCSM4_past1000_085001-185012.nc</p></li>
<li><p>tas_sfc_Amon_CCSM4_past1000_085001-185012.nc</p></li>
</ul>
</li>
<li><p><strong>Calibration</strong> data can be found under LMR_data &gt; data &gt; analyses copy &gt; GPCC</p>
<ul class="simple">
<li><p>The other calibration dataset (GISTEMPv4) comes shipped with <em>cfr</em>, but GPCCv6 does not.</p></li>
</ul>
</li>
<li><p><strong>Proxy</strong> data (<a class="reference external" href="https://paleopresto.github.io/">PReSto2k</a>) will come from the LiPDVerse or LiPDGraph notebooks.</p></li>
</ol>
<section id="load-proxies">
<h3>Load proxies<a class="headerlink" href="#load-proxies" title="Link to this heading">#</a></h3>
<p>This comes from <em>Assembling the Proxy Database from the LiPDVerse</em> , where the data is accessed through the LipDGraph and processed to fit the format of <em>cfr</em>’s <code class="docutils literal notranslate"><span class="pre">ProxyDatabase</span></code> Class.<br />
<br />
<code class="docutils literal notranslate"><span class="pre">load_proxydb()</span></code> takes in a .json, .pckl, or .nc file and with the given columns, very specific to <em>cfr</em>, creates a new <code class="docutils literal notranslate"><span class="pre">ProxyDatabase</span></code> object for our use in the reconstruction. In this specific example, we will use a NetCDF file created by afforementioned notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading from pickle...&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./prev_data/pdb_w_seasonality_annual.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle_db</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">pickle_db</span><span class="o">.</span><span class="n">nrec</span><span class="si">}</span><span class="s2"> records from pickle&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading from pickle...
Loaded 559 records from pickle
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># new</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ReconJob</span><span class="p">()</span>
<span class="n">job</span><span class="o">.</span><span class="n">proxydb</span> <span class="o">=</span> <span class="n">pickle_db</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_count</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a40d7e0084b5a2b550c4074ea18f2f8499b8ab586f4d4f03077de17f5265bb4c.png" src="../../_images/a40d7e0084b5a2b550c4074ea18f2f8499b8ab586f4d4f03077de17f5265bb4c.png" />
</div>
</div>
</section>
<section id="load-model-prior">
<h3>Load model prior<a class="headerlink" href="#load-model-prior" title="Link to this heading">#</a></h3>
<p>This reconstruction uses <a class="reference external" href="https://www.wdc-climate.de/WDCC/CMIP5/Compact.jsp?acronym=NRS4pk">CMIP5 CCSM4 past 1000</a> as the model prior. This is the Coupled Model Intercomparison Project phase 5 (CMIP5) (Taylor et al., 2012) Last Millennium simulation from the Community Climate System Model version 4 (CCSM4) coupled atmosphere–ocean–sea-ice model. The simulation covers years 850 to 1850 CE and includes incoming solar variability and variable greenhouse gases, as well as stratospheric aerosols from volcanic eruptions known to have occurred during the simulation period (Tardif et al., 2019). This model prior provides the initial climate states used in the data assimilation (DA) step.<br />
<br />
<code class="docutils literal notranslate"><span class="pre">load_clim()</span></code> loads in .nc files (or files that are shipped with the package) and formats them into <code class="docutils literal notranslate"><span class="pre">ClimateField</span></code> objects for use in the DA workflow.<br />
<br />
<code class="docutils literal notranslate"><span class="pre">anom_period</span></code> refers to the climatological reference period with which to compute climate anomalies. Tardif et al. use the full interval for LMRv2.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">load_clim</span><span class="p">(</span>
    <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span>
    
    <span class="n">path_dict</span><span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tas&#39;</span><span class="p">:</span> <span class="s1">&#39;./prev_data/ccsm4_last_millenium/tas_sfc_Amon_CCSM4_past1000_085001-185012.nc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pr&#39;</span><span class="p">:</span> <span class="s1">&#39;./prev_data/ccsm4_last_millenium/pr_sfc_Amon_CCSM4_past1000_085001-185012.nc&#39;</span>
    <span class="p">},</span>
    <span class="n">anom_period</span><span class="o">=</span><span class="p">[</span><span class="mi">850</span><span class="p">,</span><span class="mi">1850</span><span class="p">],</span>  <span class="c1"># Tardif 2019 uses entire interval</span>
    <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_path&quot;] = {&#39;tas&#39;: &#39;./prev_data/ccsm4_last_millenium/tas_sfc_Amon_CCSM4_past1000_085001-185012.nc&#39;, &#39;pr&#39;: &#39;./prev_data/ccsm4_last_millenium/pr_sfc_Amon_CCSM4_past1000_085001-185012.nc&#39;}</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_anom_period&quot;] = [850, 1850]</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_lat_name&quot;] = lat</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_lon_name&quot;] = lon</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_time_name&quot;] = time</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; The time axis does not overlap with the reference period [850, 1850]; use its own time period as reference [.2f, .2f].</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; The time axis does not overlap with the reference period [850, 1850]; use its own time period as reference [.2f, .2f].</span>
<span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; prior variables [&#39;tas&#39;, &#39;pr&#39;] loaded</span>
<span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; job.prior created</span>

</pre></div>
</div>
</div>
</div>
<p>Do a check in after loading to make sure the NetCDF file loaded in correctly. If there are any <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values, you will be warned.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check after load</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">After initial load:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape:&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contains NaN?&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sample values from first timestep:&quot;</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>After initial load:
Shape: (12012, 192, 288)
Contains NaN? False
Sample values from first timestep:
[[ 4.2724609e-04 -1.4116669e+00 -1.4149780e+00 -7.6078796e-01
  -1.3295441e+00]
 [ 2.8004456e-01  2.4789429e-01  3.3767700e-01 -5.2047729e-02
   3.3233643e-01]
 [ 4.6669006e-01 -1.6618347e-01  5.8181763e-01 -2.5801086e-01
   2.7944946e-01]
 [ 3.3268738e-01  3.2659912e-01  3.8771057e-01  4.2834473e-01
   6.8528748e-01]
 [ 3.4626770e-01  3.5942078e-01  6.5942383e-01  1.0366669e+00
   7.7363586e-01]]
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-calibration-data">
<h3>Load calibration data<a class="headerlink" href="#load-calibration-data" title="Link to this heading">#</a></h3>
<p>The calibration data sets used in this study are the NASA Goddard Institute for Space Studies (GISS) Surface Temperature Analysis (<a class="reference external" href="https://data.giss.nasa.gov/gistemp/news/2010summer/">GISTEMP</a>) (Hansen et al., 2010) version 4 for temperature and the gridded precipitation data set from the Global Precipitation Climatology Centre (<a class="reference external" href="https://psl.noaa.gov/data/gridded/data.gpcc.html">GPCC</a>) (Schneider et al., 2014) version 6 as the source of monthly information on moisture input over land surfaces (Tardif et al., 2019).<br />
<br />
<code class="docutils literal notranslate"><span class="pre">anom_period</span></code> is restricted exclusively to the instrumental period due to observational data constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">load_clim</span><span class="p">(</span>
    <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span>
    <span class="n">path_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;pr&#39;</span><span class="p">:</span> <span class="s1">&#39;./prev_data/GPCC_precip.mon.flux.1x1.v6.nc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tas&#39;</span><span class="p">:</span> <span class="s1">&#39;gistemp1200_ERSSTv4&#39;</span>
    <span class="p">},</span>
    <span class="n">rename_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pr&#39;</span><span class="p">:</span> <span class="s1">&#39;precip&#39;</span><span class="p">,</span><span class="s1">&#39;tas&#39;</span><span class="p">:</span> <span class="s1">&#39;tempanomaly&#39;</span><span class="p">},</span>
    <span class="n">anom_period</span><span class="o">=</span><span class="p">[</span><span class="mi">1951</span><span class="p">,</span> <span class="mi">1980</span><span class="p">],</span> 
    <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;obs_path&quot;] = {&#39;pr&#39;: &#39;./prev_data/GPCC_precip.mon.flux.1x1.v6.nc&#39;, &#39;tas&#39;: &#39;gistemp1200_ERSSTv4&#39;}</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;obs_rename_dict&quot;] = {&#39;pr&#39;: &#39;precip&#39;, &#39;tas&#39;: &#39;tempanomaly&#39;}</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;obs_anom_period&quot;] = [1951, 1980]</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;obs_lat_name&quot;] = lat</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;obs_lon_name&quot;] = lon</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;obs_time_name&quot;] = time</span>
<span class=" -Color -Color-Bold">&gt;&gt;&gt; The target file seems existed at: ./data/gistemp1200_ERSSTv4.nc.gz . Loading from it instead of downloading ...</span>
<span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; obs variables [&#39;pr&#39;, &#39;tas&#39;] loaded</span>
<span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; job.obs created</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="calibrate-psms">
<h2>Calibrate PSMs<a class="headerlink" href="#calibrate-psms" title="Link to this heading">#</a></h2>
<p>PSM Calibration is a crucial step in the DA process because it defines a quantitative relationship between our observational data and the climate. Since proxies don’t directly record climate variables (e.g.,temperature, precipitation), PSM calibration translates the climate variable from instrumental measurements into proxy variables (e.g., d18O, Mg/Ca). This makes sure that the proxy information is on the same scale as the prior climate state, allowing the DA algorithm to correctly weight and blend proxy data with model output. Without proper calibration, we risk introducing biases or inconsistencies between proxies and the prior, which can add error to the reconstruction. <br />
<br />
The first step is to create a dictionary between the proxy archive type and the type of calibration equation used. We also create a dictionary for which climate variable needs to be used for each proxy. For most in LMRv2.1, the calibration equation is linear univariate, with the exception being Tree Ring Width (TRW) which is bilinear, with temperature and precipitation used as inputs.<br />
<br />
Instead of using a pre-defined dictionary for proxy seasonal growth, this workflow uses the seasonality stored in each record’s metadata already converted to a list of calendar months so each proxy is calibrated using its own optimal growth period. This allows the PSM to reflect the actual seasonal sensitivity of each record. If calibration with the metadata seasonality fails, the code falls back to using an annual seasonality.
<br />
After calibration, each successfully calibrated record is tagged as ‘calibrated’, and its observation-error variance (R) is set from the PSM’s mean squared error (PSMmse). This value is then used by the DA algorithm to weight proxy information relative to the prior during assimilation.</p>
<p><code class="docutils literal notranslate"><span class="pre">calib_psms</span></code> does what was described above. It takes in the observational proxy data and calibrates it using instrumental climate data to get a best fit regression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instead of using the built-in calib_psms, create a custom calibration loop</span>
<span class="c1"># that uses individual proxy seasonality</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cfr.psm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">psm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calib_psms_seasonality</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">ptype_psm_dict</span><span class="p">,</span> <span class="n">ptype_clim_dict</span><span class="p">,</span> 
                                        <span class="n">calib_period</span><span class="o">=</span><span class="p">[</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">2015</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Calibrate proxy system models (PSMs) using individual proxy seasonality metadata.</span>
<span class="sd">   </span>
<span class="sd">   This function calibrates PSMs for each proxy record in the database using the </span>
<span class="sd">   seasonality information stored in each proxy&#39;s metadata, rather than applying</span>
<span class="sd">   uniform seasonality across proxy types. This approach allows for more accurate</span>
<span class="sd">   proxy modeling by respecting the individual seasonal response characteristics</span>
<span class="sd">   of each proxy record.</span>
<span class="sd">   </span>
<span class="sd">   Parameters</span>
<span class="sd">   ----------</span>
<span class="sd">   job : cfr.ReconJob</span>
<span class="sd">       A ReconJob object containing the proxy database and observational climate data.</span>
<span class="sd">       Must have job.proxydb (ProxyDatabase) and job.obs (dict of ClimateField objects).</span>
<span class="sd">   ptype_psm_dict : dict</span>
<span class="sd">       Dictionary mapping proxy types to PSM class names. </span>
<span class="sd">       Example: {&#39;coral.d18O&#39;: &#39;Linear&#39;, &#39;tree.TRW&#39;: &#39;Bilinear&#39;}</span>
<span class="sd">   ptype_clim_dict : dict  </span>
<span class="sd">       Dictionary mapping proxy types to lists of required climate variables.</span>
<span class="sd">       Example: {&#39;coral.d18O&#39;: [&#39;tas&#39;], &#39;tree.TRW&#39;: [&#39;tas&#39;, &#39;pr&#39;]}</span>
<span class="sd">   calib_period : list of int, optional</span>
<span class="sd">       Two-element list specifying the calibration period [start_year, end_year].</span>
<span class="sd">       Default is [1850, 2015].</span>
<span class="sd">   verbose : bool, optional</span>
<span class="sd">       If True, print calibration progress and summary statistics. Default is True.</span>
<span class="sd">       </span>
<span class="sd">   Returns</span>
<span class="sd">   -------</span>
<span class="sd">   None</span>
<span class="sd">       Modifies the job.proxydb in place by adding calibrated PSM objects to each</span>
<span class="sd">       proxy record and tagging successfully calibrated records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">pobj</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">nrec</span><span class="p">,</span> 
                         <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Calibrating PSMs with metadata seasonality&#39;</span><span class="p">):</span>
        
        <span class="n">psm_name</span> <span class="o">=</span> <span class="n">ptype_psm_dict</span><span class="p">[</span><span class="n">pobj</span><span class="o">.</span><span class="n">ptype</span><span class="p">]</span>
        
        <span class="c1"># Get climate data for this proxy</span>
        <span class="k">for</span> <span class="n">vn</span> <span class="ow">in</span> <span class="n">ptype_clim_dict</span><span class="p">[</span><span class="n">pobj</span><span class="o">.</span><span class="n">ptype</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;clim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pobj</span><span class="o">.</span><span class="vm">__dict__</span> <span class="ow">or</span> <span class="sa">f</span><span class="s1">&#39;obs.</span><span class="si">{</span><span class="n">vn</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pobj</span><span class="o">.</span><span class="n">clim</span><span class="p">:</span>
                <span class="n">pobj</span><span class="o">.</span><span class="n">get_clim</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">vn</span><span class="p">],</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">)</span>
        
        <span class="c1"># Create PSM object</span>
        <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span> <span class="o">=</span> <span class="n">psm</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">psm_name</span><span class="p">](</span><span class="n">pobj</span><span class="p">,</span> <span class="n">climate_required</span><span class="o">=</span><span class="n">ptype_clim_dict</span><span class="p">[</span><span class="n">pobj</span><span class="o">.</span><span class="n">ptype</span><span class="p">])</span>
        
        <span class="c1"># Use individual proxy seasonality from metadata</span>
        <span class="n">proxy_seasonality</span> <span class="o">=</span> <span class="n">pobj</span><span class="o">.</span><span class="n">seasonality</span>
        
        <span class="c1"># Calibrate based on PSM type</span>
        <span class="k">if</span> <span class="n">psm_name</span> <span class="o">==</span> <span class="s1">&#39;Bilinear&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
                    <span class="n">season_list1</span><span class="o">=</span><span class="p">[</span><span class="n">proxy_seasonality</span><span class="p">],</span>  <span class="c1"># Use proxy&#39;s own seasonality</span>
                    <span class="n">season_list2</span><span class="o">=</span><span class="p">[</span><span class="n">proxy_seasonality</span><span class="p">],</span>  <span class="c1"># Use proxy&#39;s own seasonality  </span>
                    <span class="n">calib_period</span><span class="o">=</span><span class="n">calib_period</span>
                <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>  
                <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
                <span class="n">season_list1</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">))],</span>
                <span class="n">season_list2</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">))],</span>
                <span class="n">calib_period</span><span class="o">=</span><span class="n">calib_period</span>
        <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
                    <span class="n">season_list</span><span class="o">=</span><span class="p">[</span><span class="n">proxy_seasonality</span><span class="p">],</span>   <span class="c1"># Use proxy&#39;s own seasonality</span>
                    <span class="n">calib_period</span><span class="o">=</span><span class="n">calib_period</span>
                <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
                <span class="n">season_list</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">))],</span>
                <span class="n">calib_period</span><span class="o">=</span><span class="n">calib_period</span>
                <span class="p">)</span>

    
    <span class="c1"># Tag calibrated records</span>
    <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">pobj</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span><span class="o">.</span><span class="n">calib_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&gt;&gt;&gt; PSM for </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s1"> failed to be calibrated.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;calibrated&#39;</span><span class="p">)</span>
            <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">pobj</span><span class="o">.</span><span class="n">psm</span><span class="o">.</span><span class="n">calib_details</span><span class="p">[</span><span class="s1">&#39;PSMmse&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">calibrated_count</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">nrec_tags</span><span class="p">(</span><span class="s2">&quot;calibrated&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&gt;&gt;&gt; </span><span class="si">{</span><span class="n">calibrated_count</span><span class="si">}</span><span class="s1"> records tagged &quot;calibrated&quot; with ProxyRecord.psm created&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># PSM to be used</span>
<span class="n">ptype_psm_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tree.TRW&#39;</span><span class="p">:</span> <span class="s1">&#39;Bilinear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tree.MXD&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;coral.d18O&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;coral.SrCa&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;coral.calc&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ice.d18O&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ice.melt&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lake.other&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lake.reflectance&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;speleothem.d18O&#39;</span> <span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sclerosponge.d18O&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;marine.other&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;borehole&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;documents&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">ptype_clim_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tree.TRW&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;tree.MXD&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;coral.d18O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;coral.SrCa&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;coral.calc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;ice.d18O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;ice.melt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;lake.other&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;lake.reflectance&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;speleothem.d18O&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;sclerosponge.d18O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;marine.other&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;borehole&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
    <span class="s1">&#39;documents&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>When the PSMs are calibrating, you will notice it skips those that dont have the number of overlapped data points being &lt; 25. This is a default parameter set to 25 that you can change in <code class="docutils literal notranslate"><span class="pre">job.calibrate</span></code> called <code class="docutils literal notranslate"><span class="pre">nobs_lb</span></code>. The default, set by Tardif et al. 2019 was set to require at least 25 years of non-contiguous overlap with calibration data as a minimum. Within the function, if nobs  &lt; nobs_lb (fewer than 25 overlapping points between observational data and climate data), the calibration is skipped because there isn’t enough data to establish a reliable statistical relationship between the proxy and climate variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the custom function</span>
<span class="n">calib_psms_seasonality</span><span class="p">(</span>
    <span class="n">job</span><span class="p">,</span> 
    <span class="n">ptype_psm_dict</span><span class="o">=</span><span class="n">ptype_psm_dict</span><span class="p">,</span>
    <span class="n">ptype_clim_dict</span><span class="o">=</span><span class="n">ptype_clim_dict</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:   3%|▎         | 19/559 [00:01&lt;00:37, 14.51it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">Asia_117 &gt;&gt;&gt; Nearest climate is NaN. Searching around within distance of 1 deg ...</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:   4%|▍         | 21/559 [00:03&lt;02:53,  3.10it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Asia_117 &gt;&gt;&gt; Found nearest climate within distance of 1 deg.</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:   5%|▌         | 29/559 [00:03&lt;01:07,  7.84it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:   6%|▋         | 35/559 [00:04&lt;00:46, 11.18it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:   7%|▋         | 37/559 [00:04&lt;00:42, 12.38it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:   8%|▊         | 42/559 [00:04&lt;00:37, 13.91it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  11%|█▏        | 64/559 [00:05&lt;00:29, 16.96it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  13%|█▎        | 75/559 [00:06&lt;00:29, 16.28it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  14%|█▍        | 81/559 [00:06&lt;00:29, 16.24it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 2 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  18%|█▊        | 100/559 [00:08&lt;00:28, 15.86it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  20%|██        | 114/559 [00:09&lt;00:32, 13.65it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">Asia_118 &gt;&gt;&gt; Nearest climate is NaN. Searching around within distance of 1 deg ...</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  21%|██        | 116/559 [00:11&lt;02:18,  3.21it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Asia_118 &gt;&gt;&gt; Found nearest climate within distance of 1 deg.</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  26%|██▌       | 144/559 [00:13&lt;00:27, 15.16it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  30%|███       | 168/559 [00:14&lt;00:24, 16.23it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  37%|███▋      | 206/559 [00:16&lt;00:22, 15.81it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">Asia_111 &gt;&gt;&gt; Nearest climate is NaN. Searching around within distance of 1 deg ...</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  37%|███▋      | 208/559 [00:18&lt;01:51,  3.14it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Asia_111 &gt;&gt;&gt; Found nearest climate within distance of 1 deg.</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  43%|████▎     | 243/559 [00:21&lt;00:20, 15.43it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  47%|████▋     | 263/559 [00:22&lt;00:18, 15.93it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  48%|████▊     | 267/559 [00:22&lt;00:18, 16.06it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  50%|████▉     | 279/559 [00:23&lt;00:16, 17.30it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  52%|█████▏    | 292/559 [00:24&lt;00:15, 17.60it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  57%|█████▋    | 318/559 [00:25&lt;00:15, 16.02it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  65%|██████▌   | 365/559 [00:28&lt;00:11, 16.48it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 12 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  68%|██████▊   | 381/559 [00:29&lt;00:10, 16.60it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">Asia_119 &gt;&gt;&gt; Nearest climate is NaN. Searching around within distance of 1 deg ...</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">Asia_119 &gt;&gt;&gt; Nearest climate is NaN. Searching around within distance of 2 deg ...</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  69%|██████▉   | 385/559 [00:33&lt;01:07,  2.57it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Asia_119 &gt;&gt;&gt; Found nearest climate within distance of 2 deg.</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  72%|███████▏  | 403/559 [00:34&lt;00:12, 12.64it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  75%|███████▍  | 418/559 [00:35&lt;00:08, 16.73it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  80%|███████▉  | 445/559 [00:36&lt;00:06, 16.96it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  89%|████████▉ | 497/559 [00:40&lt;00:03, 15.76it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 17 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  90%|████████▉ | 501/559 [00:40&lt;00:03, 16.68it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 13 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  92%|█████████▏| 512/559 [00:41&lt;00:02, 17.56it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  93%|█████████▎| 521/559 [00:41&lt;00:02, 18.12it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 16 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  94%|█████████▍| 527/559 [00:42&lt;00:01, 21.41it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  95%|█████████▌| 533/559 [00:42&lt;00:01, 22.85it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  96%|█████████▌| 536/559 [00:42&lt;00:01, 22.24it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  97%|█████████▋| 542/559 [00:42&lt;00:00, 22.74it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  98%|█████████▊| 548/559 [00:43&lt;00:00, 23.02it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality:  99%|█████████▉| 554/559 [00:43&lt;00:00, 23.15it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibrating PSMs with metadata seasonality: 100%|██████████| 559/559 [00:43&lt;00:00, 12.81it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
The number of overlapped data points is 0 &lt; 25. Skipping ...
&gt;&gt;&gt; PSM for Arc_025 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_156 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_147 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_019 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_023 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_166 failed to be calibrated.
&gt;&gt;&gt; PSM for Ant_033 failed to be calibrated.
&gt;&gt;&gt; PSM for Ant_037 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_167 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_007 failed to be calibrated.
&gt;&gt;&gt; PSM for Arc_014 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_149 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_020 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_134 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_123 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_011 failed to be calibrated.
&gt;&gt;&gt; PSM for O2kLR_183 failed to be calibrated.
&gt;&gt;&gt; PSM for Ant_050 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_102 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_157 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_158 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_154 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_138 failed to be calibrated.
&gt;&gt;&gt; PSM for Eur_006 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_105 failed to be calibrated.
&gt;&gt;&gt; PSM for Ocean2kHR_011_iso2k failed to be calibrated.
&gt;&gt;&gt; PSM for KA17RYU01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for FL17DTO02_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for BO14HTI01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for ZI04IFR01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for SA16CLA01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN03_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN02_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN06_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN07_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for ZI16ROD01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN05_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for HE13MIS01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for HE13MIS01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN04_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for RA20TAI01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for RA20TAI01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for TA18TAS01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for LI04FIJ01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for LI04FIJ01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for WU13TON01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for CH97BVB01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for KI14PAR01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for KI14PAR01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN09_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for AB20MEN08_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for XI17HAI01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for XI17HAI01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for DE14DTO01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for FE18RUS01_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for DE14DTO02_SrCa failed to be calibrated.
&gt;&gt;&gt; PSM for LI06FIJ01_d18O failed to be calibrated.
&gt;&gt;&gt; PSM for PCU-1cce3af5639a4ec failed to be calibrated.
&gt;&gt;&gt; 501 records tagged &quot;calibrated&quot; with ProxyRecord.psm created
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<section id="run-psms">
<h3>Run PSMs<a class="headerlink" href="#run-psms" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">forward_psms</span></code> runs the forward model (the PSM) with the prior as inputs and returns model-derived pseudoproxies as an output to be used in the DA solver.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">forward_psms</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;ptype_forward_dict&quot;] = {}</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Forwarding the PSMs: 100%|██████████| 501/501 [03:12&lt;00:00,  2.60it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; ProxyRecord.pseudo created for 501 records</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="annualize-and-regrid-model-prior-fields">
<h3>Annualize and Regrid model prior fields<a class="headerlink" href="#annualize-and-regrid-model-prior-fields" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">annualize_clim</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">months</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)))</span>
<span class="n">job</span><span class="o">.</span><span class="n">regrid_clim</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="n">nlat</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">nlon</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_annualize_months&quot;] = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; Processing tas ...</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; Processing pr ...</span>
<span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; job.prior updated</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_regrid_nlat&quot;] = 42</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;prior_regrid_nlon&quot;] = 63</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; Processing tas ...</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; Processing pr ...</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-save-the-job-object-for-later-reload">
<h3>(Optional) Save the job object for later reload<a class="headerlink" href="#optional-save-the-job-object-for-later-reload" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;./cases/lipd_seasonality_pda&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="run-da-solver">
<h2>Run DA solver<a class="headerlink" href="#run-da-solver" title="Link to this heading">#</a></h2>
<p>The DA solver used in LMRv2.1 (and <em>cfr</em>) is the Kalman Filter. In simple terms, the Kalman filter uses the innovation (difference between observed proxy data and forward model-derived pseudoproxy values) to adjust the model’s estimate.  The amount of adjustment depends on the relative uncertainties in the proxies and the model. The Kalman filter gives more weight to whichever source (proxy or climate) has a smaller error, resulting in an updated estimate of the climate state at each time step.</p>
<p>We run 51 Monte Carlo (MC) iterations with 100 ensemble members each. This gives us 5100 realizations of past climate states.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">run_da_mc</span><span class="p">(</span>
    <span class="n">save_dirpath</span><span class="o">=</span><span class="s1">&#39;./recons/lipd_seasonality_pda&#39;</span><span class="p">,</span>
    <span class="n">recon_seeds</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>  <span class="c1"># as an example here</span>
    <span class="n">recon_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">,</span><span class="s1">&#39;pr&#39;</span><span class="p">],</span>  <span class="c1"># running tas and pr even though paper mainly focuses on tas</span>
    <span class="n">recon_period</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;recon_period&quot;] = [1, 2000]</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;recon_loc_rad&quot;] = 25000</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;recon_timescale&quot;] = 1</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;recon_vars&quot;] = [&#39;tas&#39;, &#39;pr&#39;]</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;nens&quot;] = 100</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;recon_seeds&quot;] = [1]</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;assim_frac&quot;] = 0.75</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;save_dirpath&quot;] = ./recons/lipd_seasonality_pda</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;compress_params&quot;] = {&#39;zlib&#39;: True}</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;output_full_ens&quot;] = False</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;recon_sampling_mode&quot;] = fixed</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;trim_prior&quot;] = True</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; job.configs[&quot;allownan&quot;] = False</span>
<span class=" -Color -Color-Bold -Color-Bold-Cyan">&gt;&gt;&gt; seed: 1 | max: 1</span>

</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KF updating: 100%|██████████| 2000/2000 [21:11&lt;00:00,  1.57it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; Reconstructed fields saved to: ./recons/lipd_seasonality_pda/job_r01_recon.nc</span>
<span class=" -Color -Color-Bold -Color-Bold-Green">&gt;&gt;&gt; DONE! Total time spent: 24.43 mins.</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ReconRes</span><span class="p">(</span><span class="s1">&#39;./recons/lipd_seasonality_pda/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="figure-checks">
<h2>Figure checks<a class="headerlink" href="#figure-checks" title="Link to this heading">#</a></h2>
<p>After running the full DA workflow, we want to make sure the reconstructions actually exist, so let’s do a quick check to confirm that we get both a climate field and an ensemble time series for the <code class="docutils literal notranslate"><span class="pre">'tas'</span></code> and <code class="docutils literal notranslate"><span class="pre">'pr'</span></code> variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">load</span><span class="p">([</span><span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;tas_gm&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_gm&#39;</span><span class="p">])</span>

<span class="c1"># Create a basic plot</span>
<span class="k">if</span> <span class="s1">&#39;tas&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">recons</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">recons</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6c4c0810ac8e70b490be2d321921f6ea3245984c3d381fcfdb3dacb76e80265d.png" src="../../_images/6c4c0810ac8e70b490be2d321921f6ea3245984c3d381fcfdb3dacb76e80265d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot with ensemble spread</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">recons</span><span class="p">[</span><span class="s1">&#39;tas_gm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_qs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bb2753876b54c5f9b53433f40800604681745e265d0c3cc8e72ec6d630bd2c30.png" src="../../_images/bb2753876b54c5f9b53433f40800604681745e265d0c3cc8e72ec6d630bd2c30.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">recons</span><span class="p">[</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6189b1c0e31a5058699d682b3baa45b993e5906192bc1df4cb7efee3e56efbef.png" src="../../_images/6189b1c0e31a5058699d682b3baa45b993e5906192bc1df4cb7efee3e56efbef.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">recons</span><span class="p">[</span><span class="s1">&#39;pr_gm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_qs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9248c306873980cdaa45d31f62e2f1387a6c23724cfd6263e14363ad44d242ca.png" src="../../_images/9248c306873980cdaa45d31f62e2f1387a6c23724cfd6263e14363ad44d242ca.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/data_assimilation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../data_assembly/C01_d_db_assembly_LiPDGraph.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Assembling the proxy database from the LiPDGraph</p>
      </div>
    </a>
    <a class="right-next"
       href="../validation/C03_a_validating_PReSto2k.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Validating PReSto2k</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#author">Author</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shell-file-for-carc">shell file for CARC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-proxies">Load proxies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-model-prior">Load model prior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-calibration-data">Load calibration data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calibrate-psms">Calibrate PSMs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-psms">Run PSMs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#annualize-and-regrid-model-prior-fields">Annualize and Regrid model prior fields</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-save-the-job-object-for-later-reload">(Optional) Save the job object for later reload</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-da-solver">Run DA solver</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#figure-checks">Figure checks</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tanaya Gondhalekar, Deborah Khider, Julien Emile-Geay
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>