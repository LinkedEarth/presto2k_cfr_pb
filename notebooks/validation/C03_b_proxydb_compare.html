
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Proxy Database Comparisons &#8212; Assimilating PAGES 2k records with LinkedEarth tools</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/validation/C03_b_proxydb_compare';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Validating PReSto2k" href="C03_a_validating_PReSto2k.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
  
  
    <p class="title logo__title">Assimilating PAGES 2k records with LinkedEarth tools</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    Updating LMRv2.1 with PReSto2k and LinkedEarth Tools
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Assembly</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data_assembly/C01_c_db_assembly_LiPDverse.html">Assembling the proxy database from the LiPDVerse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_assembly/C01_d_db_assembly_LiPDGraph.html">Assembling the proxy database from the LiPDGraph</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Assimilation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data_assimilation/C02_b_DA_with_individual_seasonality.html">Run Data Assimilation (Individual Seasonality)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Validation and Comparison</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="C03_a_validating_PReSto2k.html">Validating PReSto2k</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Proxy Database Comparisons</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tanaya-g/pages2k_cfr_pb" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tanaya-g/pages2k_cfr_pb/issues/new?title=Issue%20on%20page%20%2Fnotebooks/validation/C03_b_proxydb_compare.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/validation/C03_b_proxydb_compare.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Proxy Database Comparisons</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-interpolated-vs-non-interpolated-presto2k-databases">Comparing Interpolated vs. Non-Interpolated PReSto2k databases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-original-pages2k-with-presto2k">Comparing Original PAGES2k with PReSto2k</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-meta-vs-class-based-seasonality">Comparing Meta vs. Class Based Seasonality</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="proxy-database-comparisons">
<h1>Proxy Database Comparisons<a class="headerlink" href="#proxy-database-comparisons" title="Link to this heading">#</a></h1>
<p>We want to see what the difference is in the proxy databases for those that were included before interpolation vs. after. If the reconstructions are drastically different, it is important to note what those differences can be attributed to.</p>
<p>A similar comparison is done in <a class="reference external" href="https://linked.earth/reproduce_lmr_pb/notebooks/validation/C03_b_comparison.html"><em>Proxy Database Forensics</em></a>, with other proxy databases used in this exercise, namely the records used LMRv2.1 and the LMRv2.1 reproduction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cfr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="comparing-interpolated-vs-non-interpolated-presto2k-databases">
<h2>Comparing Interpolated vs. Non-Interpolated PReSto2k databases<a class="headerlink" href="#comparing-interpolated-vs-non-interpolated-presto2k-databases" title="Link to this heading">#</a></h2>
<p>This comparison is straightforward. Since The only difference here should be the 27 records that got added in during the interpolation step, we can easily use <code class="docutils literal notranslate"><span class="pre">cfr</span></code>â€™s diff operator to directly subtract one from the other to identify the additional records. By doing this, if one reconstruction is significantly better or worse, we can more easily pinpoint which records are the cause.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading from pickle...&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./prev_data/pdb_w_seasonality_annual.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">no_interp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">no_interp</span><span class="o">.</span><span class="n">nrec</span><span class="si">}</span><span class="s2"> records from pickle&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading from pickle...&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./prev_data/pdb_w_seasonality_annual_interp.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">with_interp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">with_interp</span><span class="o">.</span><span class="n">nrec</span><span class="si">}</span><span class="s2"> records from pickle&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading from pickle...
Loaded 559 records from pickle
Loading from pickle...
Loaded 586 records from pickle
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_interp_pdb</span> <span class="o">=</span> <span class="n">no_interp</span>
<span class="n">with_interp_pdb</span> <span class="o">=</span> <span class="n">with_interp</span>

<span class="n">diff</span> <span class="o">=</span> <span class="n">with_interp_pdb</span><span class="o">-</span><span class="n">no_interp_pdb</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Interpolated Records&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x1000 with 1 Axes&gt;,
 {&#39;map&#39;: &lt;GeoAxes: title={&#39;center&#39;: &#39;Interpolated Records&#39;}&gt;})
</pre></div>
</div>
<img alt="../../_images/7e9e7510aa615050ec5887274d141eb2f2ba52f4587816ec1e15fe4f7cd065ea.png" src="../../_images/7e9e7510aa615050ec5887274d141eb2f2ba52f4587816ec1e15fe4f7cd065ea.png" />
</div>
</div>
</section>
<section id="comparing-original-pages2k-with-presto2k">
<h2>Comparing Original PAGES2k with PReSto2k<a class="headerlink" href="#comparing-original-pages2k-with-presto2k" title="Link to this heading">#</a></h2>
<p>This second comparison proves to be much more difficult. Here we compare the ProxyDatabase used in our reproduction of LMRv2.1.
Because the PID naming convention between PAGES2k in <em>cfr</em> and those pulled from the LiPDGraph are slightly different, despite possibly containing a majority of the same actual records, we have to create additional filters to catch all the similarities and differences. To bypass this without overcomplicating the names, we will use the following function <code class="docutils literal notranslate"><span class="pre">match_pid_name</span></code> to check each record between two proxy databases and make sure their lat, lon, and values match without regarding the PID.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load original used in LMRv2.1 reproduction</span>

<span class="n">pdb_og</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ProxyDatabase</span><span class="p">()</span><span class="o">.</span><span class="n">load_nc</span><span class="p">(</span><span class="s1">&#39;./prev_data/pdb/filtered_ptype_res_cfr_pages2kv2.nc&#39;</span><span class="p">)</span>
<span class="n">pdb_og</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We want the preferred pid map to be the pdb1 in the function, so when we use <code class="docutils literal notranslate"><span class="pre">rename_pids</span></code>, the <code class="docutils literal notranslate"><span class="pre">no_interp_pdb</span></code> names will change to the ones in <code class="docutils literal notranslate"><span class="pre">pdb_og</span></code>, which match the orignal naming convention used by <em>cfr</em>.</p>
<p><code class="docutils literal notranslate"><span class="pre">rename_pids</span></code> matches proxy records between two proxy databases using a multi-pass strategy that becomes progressively more flexible. It starts with manual overrides for known pairs, then tries exact location + proxy type + value matches, followed by value-only matches, location-only matches with value prioritization, and finally pure value-based matches with stricter overlap requirements. The goal is to identify corresponding records across databases that may have different naming conventions but represent the same paleoclimate data, through as many steps as can filter out incorrect matches or duplicate matches.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_pid_num</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the trailing numeric portion of a proxy record ID.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pid : str or int</span>
<span class="sd">        Proxy record identifier (e.g., &quot;Ocn_112&quot;). Can be any object</span>
<span class="sd">        convertible to string.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int or None</span>
<span class="sd">        The integer found at the end of the string if present,</span>
<span class="sd">        otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)$&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">m</span> <span class="k">else</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">values_match</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">min_overlap_fraction</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">min_correlation</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test whether two proxy value series represent the same underlying record</span>
<span class="sd">    based on overlapping time coverage and statistical similarity.</span>

<span class="sd">    The function compares two time/value series over their common overlap</span>
<span class="sd">    period. It checks (1) that enough of each record overlaps, and (2) that</span>
<span class="sd">    the values are sufficiently correlated or numerically close.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v1, v2 : array_like</span>
<span class="sd">        Value arrays for the two records.</span>
<span class="sd">    t1, t2 : array_like</span>
<span class="sd">        Time arrays corresponding to ``v1`` and ``v2``.</span>
<span class="sd">    min_overlap_fraction : float, optional</span>
<span class="sd">        Minimum fraction of overlap (by number of points) required between</span>
<span class="sd">        the two series. Default is 0.7.</span>
<span class="sd">    min_correlation : float, optional</span>
<span class="sd">        Minimum Pearson correlation coefficient required when comparing</span>
<span class="sd">        overlapping segments. Default is 0.8.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the two series are judged to match, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
        
    <span class="c1"># Find overlap</span>
    <span class="n">common_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">common_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">mask1</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span> <span class="o">&gt;=</span> <span class="n">common_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t1</span> <span class="o">&lt;=</span> <span class="n">common_end</span><span class="p">)</span>
    <span class="n">mask2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">&gt;=</span> <span class="n">common_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t2</span> <span class="o">&lt;=</span> <span class="n">common_end</span><span class="p">)</span>
    
    <span class="n">v1_overlap</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
    <span class="n">v2_overlap</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
    
    <span class="c1"># More lenient overlap check</span>
    <span class="n">overlap_frac</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2_overlap</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">overlap_frac</span> <span class="o">&gt;=</span> <span class="n">min_overlap_fraction</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2_overlap</span><span class="p">):</span>
            <span class="c1"># Same length - use both correlation and closeness</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Need at least 2 points for correlation</span>
                <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">,</span> <span class="n">v2_overlap</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">,</span> <span class="n">v2_overlap</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">equal_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">corr</span> <span class="o">&gt;=</span> <span class="n">min_correlation</span><span class="p">)</span> <span class="ow">or</span> <span class="n">close</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">,</span> <span class="n">v2_overlap</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">equal_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Different lengths - just check if they&#39;re close after interpolation to shorter length</span>
            <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2_overlap</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">min_len</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="c1"># Simple downsampling to same length</span>
                <span class="n">v1_sampled</span> <span class="o">=</span> <span class="n">v1_overlap</span><span class="p">[::</span><span class="nb">len</span><span class="p">(</span><span class="n">v1_overlap</span><span class="p">)</span><span class="o">//</span><span class="n">min_len</span><span class="p">][:</span><span class="n">min_len</span><span class="p">]</span>
                <span class="n">v2_sampled</span> <span class="o">=</span> <span class="n">v2_overlap</span><span class="p">[::</span><span class="nb">len</span><span class="p">(</span><span class="n">v2_overlap</span><span class="p">)</span><span class="o">//</span><span class="n">min_len</span><span class="p">][:</span><span class="n">min_len</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1_sampled</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2_sampled</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1_sampled</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">v1_sampled</span><span class="p">,</span> <span class="n">v2_sampled</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">return</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">corr</span> <span class="o">&gt;=</span> <span class="n">min_correlation</span>
    
    <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">match_proxy_records</span><span class="p">(</span><span class="n">pdb1</span><span class="p">,</span> <span class="n">pdb2</span><span class="p">,</span> <span class="n">tol_deg</span><span class="o">=</span><span class="mf">0.03</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Match proxy records between two databases using a multi-pass strategy.</span>

<span class="sd">    Matching proceeds in several stages:</span>
<span class="sd">      1. Apply manual overrides for known ID pairs.</span>
<span class="sd">      2. Location + proxy type + value similarity, with PID numeric tiebreak.</span>
<span class="sd">      3. Value-only matches (when no location match exists).</span>
<span class="sd">      4. Location-only matches, prioritizing value similarity.</span>
<span class="sd">      5. Pure value-based matches with stricter overlap requirements.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pdb1 : ProxyDatabase</span>
<span class="sd">        First proxy database object. Must have a ``records`` dict mapping</span>
<span class="sd">        record IDs to objects with attributes ``lat``, ``lon``, ``ptype``,</span>
<span class="sd">        ``time``, and ``value``.</span>
<span class="sd">    pdb2 : ProxyDatabase</span>
<span class="sd">        Second proxy database object, same requirements as ``pdb1``.</span>
<span class="sd">    tol_deg : float, optional</span>
<span class="sd">        Tolerance in degrees for considering two locations to be the same.</span>
<span class="sd">        Default is 0.03 (~3 km).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matches : dict</span>
<span class="sd">        Mapping from record IDs in ``pdb1`` to their matched record IDs in ``pdb2``.</span>
<span class="sd">    conflicts : dict</span>
<span class="sd">        Dictionary of unresolved or conflicting matches. Keys are ``pdb2`` IDs,</span>
<span class="sd">        values are lists of candidate ``pdb1`` IDs.</span>
<span class="sd">    missing : list</span>
<span class="sd">        List of record IDs in ``pdb1`` that could not be matched.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">,</span> <span class="n">missing</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">[]</span>
    <span class="n">used_right</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># Manual overrides first</span>
    <span class="n">manual_matches</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Ocn_112&#39;</span><span class="p">:</span> <span class="s1">&#39;Ocean2kHR_100&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Ocn_095&#39;</span><span class="p">:</span> <span class="s1">&#39;Ocean2kHR_156&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Ant_019&#39;</span><span class="p">:</span> <span class="s1">&#39;Ant_033&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Ocn_091&#39;</span><span class="p">:</span> <span class="s1">&#39;Ocean2kHR_157&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Ocn_093&#39;</span><span class="p">:</span> <span class="s1">&#39;Ocean2kHR_158&#39;</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">pages_pid</span><span class="p">,</span> <span class="n">presto_pid</span> <span class="ow">in</span> <span class="n">manual_matches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pages_pid</span> <span class="ow">in</span> <span class="n">pdb1</span><span class="o">.</span><span class="n">records</span> <span class="ow">and</span> <span class="n">presto_pid</span> <span class="ow">in</span> <span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
            <span class="n">matches</span><span class="p">[</span><span class="n">pages_pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">presto_pid</span>
            <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">presto_pid</span><span class="p">)</span>

    <span class="c1"># Pass 1: location + ptype + values + PID tiebreaker</span>
    <span class="k">for</span> <span class="n">pid1</span><span class="p">,</span> <span class="n">r1</span> <span class="ow">in</span> <span class="n">pdb1</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pid1</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="n">cands</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid2</span> <span class="k">for</span> <span class="n">pid2</span><span class="p">,</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                 <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">ptype</span> <span class="o">==</span> <span class="n">r1</span><span class="o">.</span><span class="n">ptype</span> <span class="ow">and</span>
                     <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="n">r2</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_deg</span> <span class="ow">and</span>
                     <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="n">r2</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_deg</span> <span class="ow">and</span>
                     <span class="n">pid2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_right</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Try values, then PID tiebreaker</span>
            <span class="n">value_cands</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid2</span> <span class="k">for</span> <span class="n">pid2</span> <span class="ow">in</span> <span class="n">cands</span> 
                          <span class="k">if</span> <span class="n">values_match</span><span class="p">(</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">pid2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">pid2</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">))]</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_cands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_cands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value_cands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_cands</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># PID tiebreaker</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="n">_pid_num</span><span class="p">(</span><span class="n">pid1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n1</span><span class="p">:</span>
                    <span class="n">pid_match</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid2</span> <span class="k">for</span> <span class="n">pid2</span> <span class="ow">in</span> <span class="n">value_cands</span> <span class="k">if</span> <span class="n">_pid_num</span><span class="p">(</span><span class="n">pid2</span><span class="p">)</span> <span class="o">==</span> <span class="n">n1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pid_match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pid_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pid_match</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Pass 2: values-only</span>
    <span class="k">for</span> <span class="n">pid1</span><span class="p">,</span> <span class="n">r1</span> <span class="ow">in</span> <span class="n">pdb1</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pid1</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="n">value_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid2</span> <span class="k">for</span> <span class="n">pid2</span><span class="p">,</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">pid2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_right</span> <span class="ow">and</span>
                            <span class="n">values_match</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">time</span><span class="p">)))]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Mark remaining as missing</span>
    <span class="k">for</span> <span class="n">pid1</span> <span class="ow">in</span> <span class="n">pdb1</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pid1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid1</span><span class="p">)</span>

    <span class="c1"># Pass 3: Location-only with value priority</span>
    <span class="k">for</span> <span class="n">pid1</span><span class="p">,</span> <span class="n">r1</span> <span class="ow">in</span> <span class="n">pdb1</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pid1</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="c1"># Find all records at same location regardless of ptype</span>
        <span class="n">location_matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pid2</span><span class="p">,</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pid2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_right</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="n">r2</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_deg</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="n">r2</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_deg</span><span class="p">):</span>
                <span class="n">location_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">location_matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">location_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">location_matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Prioritize value matching</span>
            <span class="n">value_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid2</span> <span class="k">for</span> <span class="n">pid2</span> <span class="ow">in</span> <span class="n">location_matches</span>
                            <span class="k">if</span> <span class="n">values_match</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">pid2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">pid2</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">))]</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># No value matches - leave unmatched rather than guess</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Multiple value matches - only use PID as very last resort</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="n">_pid_num</span><span class="p">(</span><span class="n">pid1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n1</span><span class="p">:</span>
                    <span class="n">pid_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid2</span> <span class="k">for</span> <span class="n">pid2</span> <span class="ow">in</span> <span class="n">value_matches</span> <span class="k">if</span> <span class="n">_pid_num</span><span class="p">(</span><span class="n">pid2</span><span class="p">)</span> <span class="o">==</span> <span class="n">n1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pid_matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pid_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pid_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># If still multiple candidates, leave unmatched rather than guess</span>
                
    <span class="c1"># Pass 4: Pure value matching with substantial overlap</span>
    <span class="k">for</span> <span class="n">pid1</span><span class="p">,</span> <span class="n">r1</span> <span class="ow">in</span> <span class="n">pdb1</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pid1</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="c1"># Check all remaining records for value similarity</span>
        <span class="k">for</span> <span class="n">pid2</span><span class="p">,</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">pdb2</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pid2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_right</span> <span class="ow">and</span>
                <span class="n">values_match</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">time</span><span class="p">),</span>
                    <span class="n">min_overlap_fraction</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)):</span>  <span class="c1"># Slightly more lenient</span>
                
                <span class="n">matches</span><span class="p">[</span><span class="n">pid1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pid2</span>
                <span class="n">used_right</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pid2</span><span class="p">)</span>
                <span class="k">break</span>  <span class="c1"># Take first substantial match found</span>

    <span class="c1"># Update missing list</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pdb1</span><span class="o">.</span><span class="n">records</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>


    <span class="k">return</span> <span class="n">matches</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">,</span> <span class="n">missing</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">rename_pids</span><span class="p">(</span><span class="n">pdb</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rename record identifiers (PIDs) in a ProxyDatabase.</span>

<span class="sd">    This function replaces PIDs in a ProxyDatabase according to a mapping of</span>
<span class="sd">    `{new_pid: old_pid}`. Each record with an `old_pid` key is reassigned to</span>
<span class="sd">    `new_pid`. If `new_pid` already exists in the database, that rename is skipped</span>
<span class="sd">    to avoid collisions. Records not listed in the mapping remain unchanged.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pdb : cfr.ProxyDatabase</span>
<span class="sd">        The ProxyDatabase whose records should be renamed.</span>
<span class="sd">    matches : dict</span>
<span class="sd">        Dictionary mapping `{new_pid: old_pid}`. Keys are the preferred PIDs to</span>
<span class="sd">        assign, values are the current PIDs in `pdb`.</span>
<span class="sd">    in_place : bool, optional</span>
<span class="sd">        If True, rename records directly in `pdb`. If False (default), return a</span>
<span class="sd">        modified copy and leave the original unchanged.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cfr.ProxyDatabase</span>
<span class="sd">        A ProxyDatabase with updated PIDs following the mapping. If `in_place`</span>
<span class="sd">        is False, this is a new object; otherwise the input object is modified</span>
<span class="sd">        and returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">pdb</span> <span class="k">if</span> <span class="n">in_place</span> <span class="k">else</span> <span class="n">pdb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">records</span>
    <span class="k">for</span> <span class="n">new_pid</span><span class="p">,</span> <span class="n">old_pid</span> <span class="ow">in</span> <span class="n">matches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">old_pid</span> <span class="ow">in</span> <span class="n">recs</span> <span class="ow">and</span> <span class="n">new_pid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">recs</span><span class="p">:</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="n">recs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_pid</span><span class="p">)</span>
            <span class="c1"># update the record&#39;s internal pid if it has one</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="s2">&quot;pid&quot;</span><span class="p">):</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">new_pid</span>
            <span class="n">recs</span><span class="p">[</span><span class="n">new_pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
    <span class="k">return</span> <span class="n">db</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now test the  matching</span>
<span class="n">matches</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">,</span> <span class="n">missing</span> <span class="o">=</span> <span class="n">match_proxy_records</span><span class="p">(</span><span class="n">pdb_og</span><span class="p">,</span> <span class="n">no_interp_pdb</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== MATCHING RESULTS ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matches found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflicts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">conflicts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing from PReSto2k: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== MATCHING RESULTS ===
Matches found: 505
Conflicts: 0
Missing from PReSto2k: 53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Re-run the renaming with all matches</span>
<span class="n">no_interp_fully_renamed</span> <span class="o">=</span> <span class="n">rename_pids</span><span class="p">(</span><span class="n">no_interp_pdb</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have renamed the matching pids, we can use the Proxy Database subtraction that is built into <em>cfr</em>. This will give us two maps of which records are missing from both the PReSto2k database and the original PAGES2k database used to reproduce LMRv2.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the map of records not in PAGES2k </span>

<span class="n">diff</span> <span class="o">=</span> <span class="n">no_interp_fully_renamed</span> <span class="o">-</span> <span class="n">pdb_og</span>

<span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;In PReSto2k not PAGES2k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_167 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_024 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_086 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_076 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_099 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_158 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_035 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_177 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_171 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_069 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_170 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_088 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_116 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_130 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_131 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_147 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_174 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_160 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_172 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_066 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_166 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_140 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_141 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_179 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_007 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_028 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_005 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_168 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_142 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_143 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_129 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_120 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_121 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_127 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_008 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_128 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_173 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_118 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_139 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_061 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_062 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_079 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_131 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_107 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_157 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_146 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_181 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_182 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_162 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_163 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_161 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_125 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_090 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_119 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_097 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_159 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_024 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_169 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_071 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_072 failed.</span>

</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x1000 with 1 Axes&gt;,
 {&#39;map&#39;: &lt;GeoAxes: title={&#39;center&#39;: &#39;In PReSto2k not PAGES2k&#39;}&gt;})
</pre></div>
</div>
<img alt="../../_images/5d48b3fbaba45a6d586e849e2e86857903ac5ac30caa834cbc0c24323c0f0682.png" src="../../_images/5d48b3fbaba45a6d586e849e2e86857903ac5ac30caa834cbc0c24323c0f0682.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the map of records not in PReSto2k</span>

<span class="n">diff_other</span> <span class="o">=</span> <span class="n">pdb_og</span> <span class="o">-</span> <span class="n">no_interp_fully_renamed</span>

<span class="n">diff_other</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;In PAGES2k not PReSto2k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting SAm_020 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LPDb9285123 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_026 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting SAm_0243 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_022 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_037 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3100 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting SAm_032 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_002 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_031 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_017 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_016 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_058 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_031dD failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_031 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_018 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting O2kLR_183 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_050 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asia_235 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_014 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_023 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Africa_001 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocean2kHR_011_iso2k failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting KA17RYU01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting FL17DTO02_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting BO14HTI01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting SA16CLA01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN03_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN02_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN06_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN07_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting ZI16ROD01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN05_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting HE13MIS01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting HE13MIS01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN04_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting RA20TAI01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting RA20TAI01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting TA18TAS01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LI04FIJ01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LI04FIJ01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting WU13TON01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting CH97BVB01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting HE18COC01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting HE18COC01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting MU18NPI01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting MU18NPI01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting ZI15IMP02_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting KI14PAR01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting KI14PAR01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting ZI15IMP01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting GO08BER01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting GO08BER01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting KI08PAR01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN09_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN08_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting XI17HAI01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting XI17HAI01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting DE14DTO01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting DE14DTO02_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LI06FIJ01_d18O failed.</span>

</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x1000 with 1 Axes&gt;,
 {&#39;map&#39;: &lt;GeoAxes: title={&#39;center&#39;: &#39;In PAGES2k not PReSto2k&#39;}&gt;})
</pre></div>
</div>
<img alt="../../_images/567533e23253d6e6e81a131884bc7ee32f98278033abf09d513f0aade80a8923.png" src="../../_images/567533e23253d6e6e81a131884bc7ee32f98278033abf09d513f0aade80a8923.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">records</span><span class="p">)</span><span class="si">}</span><span class="s1"> in PReSto2k but NOT in PAGES2k&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">diff_other</span><span class="o">.</span><span class="n">records</span><span class="p">)</span><span class="si">}</span><span class="s1"> in PAGES2k but NOT in PReSto2k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 61 in PReSto2k but NOT in PAGES2k
There are 60 in PAGES2k but NOT in PReSto2k
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparing-meta-vs-class-based-seasonality">
<h2>Comparing Meta vs. Class Based Seasonality<a class="headerlink" href="#comparing-meta-vs-class-based-seasonality" title="Link to this heading">#</a></h2>
<p>We will now run the same renaming/matching test on metadata based Proxy Database and class-based. One important difference of note is that we are doing this comparison before calibration. The calibration step automatically filters out a number of records that do not meet certain requirements (See: <em>Run Data Assimilation</em>). Due to this, the <code class="docutils literal notranslate"><span class="pre">class_og</span></code> proxy database is unfiltered from the get-go (initial LiPD dataframe) and not filtered by resolution unlike the metadata ones (both with and without interpolation). During calibration, ~120 records get removed and hence this current proxy database appears significantly larger than what is actually assimilated in the DA step.</p>
<p>In a further experiment, it will be helpful to compare just the records that were used post-calibration between the two Proxy Databases to get a full breakdown for why one reconstruction outperforms the other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_og</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">ProxyDatabase</span><span class="p">()</span><span class="o">.</span><span class="n">load_nc</span><span class="p">(</span><span class="s1">&#39;./prev_data/lipd_pdb_pids.nc&#39;</span><span class="p">)</span>
<span class="n">class_og</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matches_2</span><span class="p">,</span> <span class="n">conflicts_2</span><span class="p">,</span> <span class="n">missing_2</span> <span class="o">=</span> <span class="n">match_proxy_records</span><span class="p">(</span><span class="n">class_og</span><span class="p">,</span> <span class="n">no_interp_pdb</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Re-run the renaming with all matches</span>
<span class="n">no_interp_fully_renamed_2</span> <span class="o">=</span> <span class="n">rename_pids</span><span class="p">(</span><span class="n">no_interp_pdb</span><span class="p">,</span> <span class="n">matches_2</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffo</span> <span class="o">=</span> <span class="n">class_og</span> <span class="o">-</span> <span class="n">no_interp_fully_renamed_2</span>
<span class="n">diffo2</span> <span class="o">=</span> <span class="n">no_interp_fully_renamed_2</span><span class="o">-</span><span class="n">class_og</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocean2kHR_095 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_031dD failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocean2kHR_157 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocean2kHR_158 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting FL17DTO02_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN03_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN07_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LI04FIJ01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LI06FIJ01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_066 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_324 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_156 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_010 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_051 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_045 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_040 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-EmeraldBasin.Keigwin.2007_LPD68872399 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant-DSS.DahlJensen.1999_LPD7abab671 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3810 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_194 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_193 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-MD98-2160.Newton.2010_LPD7e8e8eaa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-WestSpitzberg.Bonnet.2010_LPD995c6f3c failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_074 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3804 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-FiskBasin.Richey.2009_LPD57d40973 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_024 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_230 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_044 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-AlboranSea436B.Nieto-Moreno.2013_LPD0e0867fe failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_187 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_317 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_001 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_305 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-CH07-98-MC-22.Saenger.2011_LPDa03ec713 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3816 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-FeniDrift.Richter.2009_LPD47182517 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-WesternSvalbard.Spielhagen.2011_O2kLR_007 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3851 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_009 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-MD98-2177.Newton.2010_LPD30c5b95c failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-ODP984.Came.2007_LPDbd07f717 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_247 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_009 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_321 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_025 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-GulfofGuinea.Weldeab.2007_LPD9cc3baf6-dup failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_030 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_073 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-SouthChinaSea.Zhao.2006_LPD44b374e7 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_082 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_328 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-JacafFjord.Sepulveda.2009_LPD6315f935 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_320 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_114 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3801 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi-SihailongwaLake.Chu.2011_LPDdc74a376 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3870 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_013 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Aus-DuckholeLake.Saunders.2013_LPD335d863f failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_039 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_150 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_042 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-PigmyBasin.Richey.2015_LPD572f7cc3 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-MD95-2011.Grimalt.2002_O2kLR_105 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_125 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Afr-LakeMalawi.Powers.2011_Malawi05 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-MinorcaContourite.Moreno.2012_LPD10e9f8f7 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Afr_004 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3853 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_327 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-CariacoBasin.Lea.2003_LPDcda1c277 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_047 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_326 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Afr-P178-15P.Tierney.2015_LPD53e179ad failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Afr-P178-15P.Tierney.2015_LPD81e53153 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_101 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-WesternAntarcticPeninsula.Shevenell.2011_LPD2a3997a7 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3798 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_329 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-TagusMudPatch.Abrantes.2005_LPDb7ba9166 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant-WDC06A.Steig.2013_Ant_031dD failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_319 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3807 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_165 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_056 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_129 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_128 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-SouthAtlanticWestAfrica.Leduc.2010_LPDa77273bb failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-DryTortugas.Lund.2006_LPDf7bace53 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_325 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_036 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-GreatBahamaBank.Lund.2006_LPD7c7e19c5 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_008 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3867 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3868 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-WEqPacific.Stott.2007_O2kLR_131 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-SWCoastOfIndia.Saraswat.2013_O2kLR_118 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_052 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-EasternTropicalNorthAtlantic.Kuhnert.2011_LPD13a78f9b failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_126 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_127 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_175 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_146 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_195 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-Philippines.Stott.2007_LPD1a0245b7 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_148 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_012 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_037 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-GreatBahamaBank.Richter.2006_LPDefb3d2b0 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_041 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_078 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-RAPiD-12-1K.Thornalley.2009_LPDb17a5e9e-dup failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_043 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Eur_010 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_049 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting NAm_3819 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_335 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-CariacoBasin.Black.2007_LPDe51d17e8 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-AlboranSea384B.Nieto-Moreno.2013_LPDasan2012 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ant_035 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_157 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_158 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn-CapeGhir.McGregor.2007_LPD84ab67b9 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_079 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_053 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_017 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_048 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Arc_045 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Ocn_135 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting Asi_318 failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting CO00DRBE_Ocean2kHR_125_iso2k failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting SS03HAJA_Ocean2kHR_128_iso2k failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting FL17DTO02_FL17DTO02_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN03_AB20MEN03_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting AB20MEN07_AB20MEN07_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting DR00NBB01_DR00NBB01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LI04FIJ01_LI04FIJ01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting RO19PAR01_RO19PAR01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting HE02GBR01_HE02GBR01_d18O failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting HE02GBR01_HE02GBR01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting KI08PAR01_KI08PAR01_SrCa failed.</span>
<span class=" -Color -Color-Bold -Color-Bold-Yellow">&gt;&gt;&gt; Subtracting LI06FIJ01_LI06FIJ01_d18O failed.</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffo</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;in PReSto2k class not meta&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x1000 with 1 Axes&gt;,
 {&#39;map&#39;: &lt;GeoAxes: title={&#39;center&#39;: &#39;in PReSto2k class not meta&#39;}&gt;})
</pre></div>
</div>
<img alt="../../_images/afdec196eb8b191f01af704f7c31e5e2653623418ac7a402989bd4cd8de5ac58.png" src="../../_images/afdec196eb8b191f01af704f7c31e5e2653623418ac7a402989bd4cd8de5ac58.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffo2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;in PReSto2k meta not class&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x1000 with 1 Axes&gt;,
 {&#39;map&#39;: &lt;GeoAxes: title={&#39;center&#39;: &#39;in PReSto2k meta not class&#39;}&gt;})
</pre></div>
</div>
<img alt="../../_images/3c9344fb14dfea469dccd0091c36b81c97c0644c5527b355973ca0b8d28cb6c8.png" src="../../_images/3c9344fb14dfea469dccd0091c36b81c97c0644c5527b355973ca0b8d28cb6c8.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/validation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="C03_a_validating_PReSto2k.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Validating PReSto2k</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-interpolated-vs-non-interpolated-presto2k-databases">Comparing Interpolated vs. Non-Interpolated PReSto2k databases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-original-pages2k-with-presto2k">Comparing Original PAGES2k with PReSto2k</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-meta-vs-class-based-seasonality">Comparing Meta vs. Class Based Seasonality</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tanaya Gondhalekar, Deborah Khider, Julien Emile-Geay
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>